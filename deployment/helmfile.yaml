environments:
  preview:
    values:
      # If testing out a feature branch of the Helm chart, uncomment the Git url:
      - repoUrl: git+https://github.com/appuio/charts@appuio/cloud-portal?ref=cloud-portal
  integration: {}

repositories:
  - name: appuio
    url: "{{ getOrNil "repoUrl" .Values | default "https://charts.appuio.ch" }}"

helmDefaults:
  historyMax: 3

releases:
  - name: "{{ env "HELM_RELEASE_NAME" | default "portal" }}"
    chart: appuio/cloud-portal
    version: v0.1.0
    createNamespace: false
    missingFileHandler: Warn
    values:
      - "{{ .Environment.Name }}.yaml"
      - image:
          tag: {{ trimPrefix "refs/tags/" (requiredEnv "IMG_TAG") }}
          repository: "{{ .Namespace }}/cloud-portal"
      - fullnameOverride: {{ env "HELM_RELEASE_NAME" | default "portal" }}
      - podAnnotations:
          app.kubernetes.io/git-shasum: {{ env "GIT_SHA" | default "GIT_SHA" }}
      - portal:
          config:
            version: {{ env "GIT_SHA" | default "GIT_SHA" }}
